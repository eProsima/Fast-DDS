/*************************************************************************************************/
/**********                          STEPS FOR JENKINS PROJECT                          **********/
/*************************************************************************************************/

STEP 1:
	// Clean old dockers
	for ip in ${publisher_ips}; do docker -H $ip rm $(docker -H $ip stop $(docker -H $ip ps -q --filter="name=TestPub")) || true; done
	for ip in ${subscriber_ips}; do docker -H $ip rm $(docker  -H $ip stop $(docker -H $ip ps -q --filter="name=TestSub")) || true; done

STEP 2:
	// Build FastRTPS
	mkdir build && cd build
	cmake .. -DTHIRDPARTY=ON -DPERFORMANCE_TESTS=ON -DVIDEO_TESTS=ON -DMEMORY_TESTS=ON
	make

STEP 3:
	// Copy Binary files
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so.1.6.0" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so.1" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/thirdparty/fastcdr/src/cpp/libfastcdr.so.1.0.7" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/thirdparty/fastcdr/src/cpp/libfastcdr.so" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/LatencyTest" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/ThroughputTest" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/VideoTest" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/build/test/memory/MemoryTest" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/memory/memory_analysis.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/memory/memory_tests.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/performance/payloads_demands.csv" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/GenerateTestsAndXMLs.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/PublisherTests.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/SubscriberTests.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/AnalyzeTests.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/LaunchTests.py" /mnt/perfshare
	cp "/workspace/Multi-Node Manual Linux/test/CopyAndRenameCSV.py" /mnt/perfshare

STEP 4:
	// Launch Tests	
	python3 "/mnt/perfshare/LaunchTests.py" ${publisher_ips} ${subscriber_ips}

STEP 5:
	// Copy and Rename output files
	python3 "/mnt/perfshare/CopyAndRenameCSV.py" "/mnt/perfshare/output" "/mnt/perfshare/csv"

STEP 6:
	// Analize results
	python3 "/mnt/perfshare/AnalyzeTests.py" "/mnt/perfshare/csv"
