/*************************************************************************************************/
/**********                      STEPS FOR JENKINS PROJECT                              **********/
/*************************************************************************************************/

STEP 1:
	// Mount shared folder
	mkdir /mnt/jenkins
	mount -t cifs -o username=${network_user},password=${network_password} //mainserver.intranet.eprosima.com/Public/JenkinsTests /mnt/jenkins


STEP 2:
	// Build FastRTPS
	exit `ctest -VV --no-compress-output --output-on-failure -DJENKINS_BUILD_NAME="${BUILD_TAG}" \
	-DJENKINS_BUILD_OPTIONS="-DEPROSIMA_BUILD=ON -DPERFORMANCE_TESTS=ON -DVIDEO_TESTS=ON -DGTEST_INDIVIDUAL=ON  -DDISABLE_UDPV6_TESTS=ON -DSECURITY=${security}" \
    -DJENKINS_BUILD_CONFIGURATION=RelWithDebInfo -DDISABLE_CTEST_COVERAGE=ON -DJENKINS_DASHBOARD="Experimental" -S CTestJenkins.cmake 1>&2 | tail -n 1`

STEP 3:
	// Copy Binary files
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so.1.6.0" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so.1" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/src/cpp/libfastrtps.so" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/thirdparty/fastcdr/src/cpp/libfastcdr.so.1.0.7" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/thirdparty/fastcdr/src/cpp/libfastcdr.so" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/LatencyTest" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/ThroughputTest" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/test/performance/VideoTest" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/build/test/memory/MemoryTest" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/memory/memory_analysis.py" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/memory/memory_tests.py" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/performance/payloads_demands.csv" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/GenerateTestsAndXMLs.py" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/PublisherTests.py" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/SubscriberTests.py" /mnt/jenkins
	cp "/workspace/Multi-Node Manual Linux/test/AnalyzeTests.py" /mnt/jenkins

STEP 4:
	// Launch Tests	
	python3 "/mnt/jenkins/LaunchTests.py" ${network_user} ${network_password} ${publisher_ips} ${subscriber_ips}

STEP 5:
	// Copy and Rename output files
	python3 "/mnt/jenkins/CopyAndRenameCSV.py" "/mnt/jenkins/output" "/mnt/jenkins/csv"

STEP 6:
	// Analize results
	python3 "/mnt/jenkins/AnalyzeTests.py" "/mnt/jenkins/csv"


LAST STEP:
	// Copy Results ??
	cp "build/Testing/`head -n 1 "build/Testing/TAG"`/Test.xml" "build/CTestResults.xml"